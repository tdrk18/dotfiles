# Source Prezto.
if [[ -s "${ZDOTDIR:-$HOME}/workspace/project/dotfiles/zsh/zprezto/init.zsh" ]]; then
  source "${ZDOTDIR:-$HOME}/workspace/project/dotfiles/zsh/zprezto/init.zsh"
fi

# 自動補完
autoload -U compinit; compinit

# コマンドの途中でもカーソル位置で補完
setopt complete_in_word

# カーソル位置を保持してファイル名一覧を補完
setopt always_last_prompt

# ディレクトリ名を直接入力するとそこに移動する
setopt auto_cd

# cdした先のディレクトリをディレクトリスタックに保存
setopt auto_pushd

# pushdしたとき、すでにスタックにあれば保存しない
setopt pushd_ignore_dups

# 色を使う
setopt prompt_subst

# ヒストリを保存するファイル
HISTFILE=$HOME/.zsh_history

# メモリ上のヒストリ数
HISTSIZE=1000000
SAVEHIST=$HISTSIZE

# 直前と同じコマンドをヒストリに追加しない
setopt hist_ignore_dups

# すぐにヒストリファイルに追記
setopt inc_append_history

# zshプロセス間でヒストリを共有
setopt share_history

# 実行したプロセスが30秒以上かかったらその時間を表示する
REPORTTIME=30

# タブ名を'title hogehoge'でhogehogeに変更する
function title {
    echo -ne "\033]0;"$*"\007"
}

# pecoを使ってコマンド履歴を表示する
function peco-select-history() {
    local tac
    if which tac > /dev/null; then
        tac="tac"
    else
        tac="tail -r"
    fi
    BUFFER=$(\history -n 1 | \
        eval $tac | \
        peco --query "$LBUFFER")
    CURSOR=$#BUFFER
    # zle clear-screen
    zle accept-line
}
zle -N peco-select-history
bindkey '^r' peco-select-history

function peco-find() {
    local current_buffer=$BUFFER
    local search_root=""
    local file_path=""
    if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
        search_root=`git rev-parse --show-toplevel`
    else
        search_root=`pwd`
    fi
    file_path="$(find ${search_root} -maxdepth 5 -type d ! -path "*/.*" | peco)"
    BUFFER="${current_buffer} ${file_path}"
    CURSOR=$#BUFFER
    # zle clear-screen
    zle accept-line
}
zle -N peco-find
bindkey '^f' peco-find

function peco_select_from_git_status(){
    git status --short | \
        peco | \
        awk -F ' ' '{print $NF}' | \
        tr '\n' ' '
}
function peco_insert_selected_git_files(){
    LBUFFER+=$(peco_select_from_git_status)
    CURSOR=$#LBUFFER
    zle reset-prompt
}
zle -N peco_insert_selected_git_files
bindkey "^g^s" peco_insert_selected_git_files


# Alias
case "${OSTYPE}" in
# MacOS用エイリアス
darwin*)
    alias inst='brew install'
    alias uninst='brew rm'
    alias update='brew update'
    alias upgrade='brew upgrade'
    alias ls='ls -lG'
    alias la='ls -alG'
    alias emacs='/Applications/Emacs.app/Contents/MacOS/Emacs'
    ;;
# Linux用エイリアス
linux*)
    alias inst='sudo apt-get install'
    alias uninst='sudo apt-get autoremove'
    alias update='sudo apt-get update'
    alias upgrade='sudo apt-get upgrade'
    alias ls='ls -l --color'
    alias la='ls -al --color'
    alias emacs='TERM=xterm-256color emacs'
    alias pdf='evince'
    ;;
esac
alias zreload='exec zsh'

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

alias latexmk='latexmk -pvc'
alias lmk='latexmk'
alias tmux='tmux -2'
alias tmuxa='tmux a'
alias tmuxn='tmux new-session \; source-file ~/.tmux-session'

# for my project
alias dic='ruby $HOME/workspace/project/dictionary/dict.rb'

# for lab-server ssh login
alias nanaco='ssh nanaco'
alias sashico='ssh sashico'
alias unico='ssh unico'
alias deco='ssh deco'
alias mico='ssh mico'
alias www='ssh www'

